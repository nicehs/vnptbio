### Run it for kubectl
aws eks --region ap-southeast-1 update-kubeconfig --name biocenter-cluster

### Install registry
helm repo add twuni https://helm.twun.io
helm repo update
kubectl create serviceaccount registry-sa --namespace default
kubectl annotate serviceaccount registry-sa   eks.amazonaws.com/role-arn=arn:aws:iam::136079915181:role/eks-irsa-registry-role   --namespace default
helm upgrade --install docker-registry twuni/docker-registry   --namespace default   --create-namespace   --set persistence.enabled=false   --set service.type=NodePort   --set service.port=5000  \
 --set storage=s3   --set s3.region=ap-southeast-1   --set s3.bucket=registry-bio1   --set s3.encrypt=true   --set serviceAccount.create=false   --set serviceAccount.name=registry-sa   --set secrets.s3.secretKey=""

### Install ingress
helm repo add eks https://aws.github.io/eks-charts
helm repo update
kubectl create serviceaccount aws-load-balancer-controller --namespace kube-system
kubectl annotate serviceaccount aws-load-balancer-controller   -n kube-system   esks.amazonaws.com/role-arn=arn:aws:iam::136079915181:role/eks-load-balancer-controller-role
helm upgrade --install aws-load-balancer-controller eks/aws-load-balancer-controller   -n kube-system   --set clusterName=biocenter-cluster   --set serviceAccount.create=false \
  --set region=ap-southeast-1   --set vpcId=vpc-0db7c2b9f04bb48c0   --set serviceAccount.name=aws-load-balancer-controller

helm repo add elastic https://helm.elastic.co
helm repo update
helm install elasticsearch elastic/elasticsearch \
  --namespace logging --create-namespace \
  --set replicas=3 \
  --set volumeClaimTemplate.storageClassName=gp3 \
  --set volumeClaimTemplate.resources.requests.storage=20Gi
eksctl create addon --name aws-ebs-csi-driver --cluster biocenter-cluster --region ap-southeast-1
helm upgrade --install kibana elastic/kibana --namespace logging --set service.type=ClusterIP

aws eks update-nodegroup-config \
  --cluster-name biocenter-cluster \
  --nodegroup-name vnpt-node-group1 \
  --scaling-config minSize=1,maxSize=4,desiredSize=3

helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm upgrade --install ingress-nginx ingress-nginx/ingress-nginx \
  --namespace ingress-nginx --create-namespace \
  --set controller.replicaCount=2 \
  --set controller.service.type=NodePort \
  --set controller.service.externalTrafficPolicy=Local
